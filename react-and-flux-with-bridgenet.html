<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<title>Productive Rage - React (and Flux) with Bridge.net</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="theme-color" content="#393939" />
	<link rel="stylesheet" type="text/css" media="all" href="/Content/Styles.css" />
	<link rel="stylesheet" type="text/css" media="print" href="/Content/PrintOverrides.css" />
	<link rel="canonical" href="http://www.productiverage.com/react-and-flux-with-bridgenet" />
	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.productiverage.com/feed" />
	<script type="text/javascript">
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', "UA-32312857-1", { 'storage': 'none' });
		ga('send', 'pageview');
	</script>
	<script type="text/javascript">
		var darkModeEnabledLocalStorageKey = "DarkMode";
		var darkModeHtmlWrapperClassName = "DarkMode";
		function IsDarkModeEnabled() {
			return localStorage.getItem(darkModeEnabledLocalStorageKey) !== null;
		}
		if (IsDarkModeEnabled()) {
			document.querySelector("html").classList.add(darkModeHtmlWrapperClassName);
		}
	</script>

    <meta name="description" content="A couple of months ago I talked about using DuoCode to write React applications in C#. Since then I&#x27;ve been waiting for DuoCode to release information about their licensing and it&#x27;s been a case of.." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="productiverage" />
    <meta name="twitter:title" content="React (and Flux) with Bridge.net" />
    <meta name="twitter:image" content="http://www.productiverage.com/Content/Images/Grouch.jpg" />
    <meta name="twitter:description" content="A couple of months ago I talked about using DuoCode to write React applications in C#. Since then I&#x27;ve been waiting for DuoCode to release information about their licensing and it&#x27;s been a case of.." />
</head>

<body>

	<div class="Header">
		<div class="HeaderContent">
			<h1>
				<a href="/">Productive Rage</a>
			</h1>
			<span class="Tagline">Dan's techie ramblings</span>
		</div>
	</div>

	<div class="WrapperOuter">
		<div class="Wrapper">
			<div class="Main HasSideBar">
				

        <script type="text/javascript">
            var disqus_shortname = "productiverage";
            document.addEventListener(
                "DOMContentLoaded",
                function () {
                    var commentsLinks = document.querySelectorAll("div.Content p.Comments");
                    for (var i = 0; i < commentsLinks.length; i++) {
                        commentsLinks[i].style.display = "block";
                    }
                }
            );
        </script>

    <div class="Content SinglePost">
        <p class="PostDate">23 July 2015</p><h2 id="react-and-flux-with-bridge.net"><a href="/react-and-flux-with-bridgenet">React (and Flux) with Bridge.net</a></h2>
<p>A couple of months ago I talked about using <a href="/react-and-flux-with-duocode">DuoCode to write React applications in C#</a>. Since then I've been waiting for DuoCode to release information about their licensing and it's been a case of &quot;in a few days&quot; for weeks now, so I've been looking around to if there are any alternatives. A few weeks ago I tried out <a href="http://bridge.net/">Bridge.net</a> which is an open source C#-to-JavaScript translator. It's been public for about the same length of time as DuoCode and releases have been about one a month, similar to DuoCode.</p>
<p>Its integration with Visual Studio doesn't have a dedicated project type option and it doesn't support the debug-in-VS-when-running-in-IE facility that DuoCode has. The compiler doesn't seem to be quite as mature as DuoCode's, I've found a few bugs with it.. but I've reported them on their forum and they've addressed them all! I reported <a href="http://forums.bridge.net/forum/bridge-net-pro/bugs/310-name-conflicts-for-implemented-interface-method-with-multiple-signatures-present">one bug</a> in their forum and got a reply 14 minutes later saying that a fix had been pushed to GitHub - not bad service, that! :D</p>
<p>It currently uses something called NRefactory to parse C# but it's moving over to Roslyn soon*. It has recently acquired <a href="http://saltarelle-compiler.com/">Saltarelle</a>, another open source C#-to-JavaScript translator, so now has even more resources working on it. Enough introduction, though, you can find out more on <a href="http://bridge.net/">their website</a> if you want to!</p>
<p>* <em>(It seems that with the release of Visual Studio 2015 and with Roslyn hitting the mainstream, Mono is another project moving over from using NRefactory to Roslyn for its C# parsing, read more from Miguel de Icaza at <a href="http://tirania.org/blog/archive/2015/Jul-21.html">Roslyn and Mono</a> - I'm excited by this since I think Roslyn is really going to open some doors for C#'s extensibility in the future; Bridge, Mono and DuoCode are all examples of this.. I've also used it for some simple code analysis in the past, see <a href="/locating-todo-comments-with-roslyn">Locating TODO comments with Roslyn</a>).</em></p>
<h3 id="getting-started-with-bridge.net"><a href="/react-and-flux-with-bridgenet#getting-started-with-bridge.net">Getting started with Bridge.net</a></h3>
<p>One of the nice things about DuoCode is that it made it <em>extremely</em> easy to get started - you can create a new DuoCode project and run it directly. I believe that the Visual Studio project system has historically been a bit of a mess so there must have been a lot of work gone into this to make it so seamless.</p>
<p>Bridge is a bit different, though. The simplest way to get started is to create a new Class Library project and add the Bridge.net NuGet package. This will not make it directly executable but it does add a demo.html file (under &quot;Bridge/www&quot;) that you can browse to (either by locating it in the file system or by just right-clicking on it and selecting &quot;View in Browser&quot;).</p>
<p>With DuoCode, you have the option of splitting your work over multiple projects - the &quot;runnable&quot; project can reference one or more other DuoCode projects and everything will still work just fine. The problem may come, however, if you want your main project to also host some .net code - you might want to create  a <a href="http://www.asp.net/web-api">Web API</a> interface, for example, for the client-side code to call. But it's not possible to have a single project that translates <em>some</em> of its C# into JavaScript but also leaves some of it running as .net on the server.</p>
<p>In Bridge, I would recommend creating a standard ASP.net MVC web project and then adding one or more Bridge class libraries that copy their generated JavaScript into a location in the front end project. Bridge makes this easy as each project that pulls in the NuGet package creates a file &quot;Bridge/bridge.json&quot; which allows you to specify where the output JavaScript should go. (Currently, adding the NuGet package <em>always</em> pulls in the &quot;getting started&quot; folders, such as &quot;Bridge/www&quot;, but I'm hopeful that a just-the-basics package will be available before too long - there's a forum thread I started about it on their site: <a href="http://forums.bridge.net/forum/community/help/311-disable-re-pulling-of-nuget-package-files-such-as-deploy-bat-when-updating">Refining the NuGet package</a>).</p>
<h3 id="working-with-react"><a href="/react-and-flux-with-bridgenet#working-with-react">Working with React</a></h3>
<p>I'm going to assume that you're familiar with <a href="https://facebook.github.io/react/">React</a> and, to make my life easier in writing this article as much as anything, I'm going to assume no knowledge of my <a href="/react-and-flux-with-duocode">DuoCode/React post</a>. I've written before about writing <a href="/typescript-es6-classes-for-react-components-without-the-hacks">React components in TypeScript</a> and the same sort of concepts will be covered here - but, again, I'm going to assume you haven't read that and I'll start from scratch.</p>
<p>I'll start from the &quot;React.render&quot; method and work out from there. So first we need to write a binding to it. A binding is essentially a way to tell your C# at compile time about something that will be present at runtime.</p>
<p>To define &quot;React.render&quot; I'll create a class with an &quot;Ignore&quot; attribute on it - this instructs the translator that it does not need to generate any JavaScript from this C# class, it will be tied up to JavaScript already loaded in the browser (the assumption here, of course, is that the page that will execute the JavaScript translated from C# will also include the &quot;React.js&quot; library).</p>
<pre><code>using Bridge.Html5;

namespace Bridge.React
{
  [Name(&quot;React&quot;)]
  [Ignore]
  public static class React
  {
    [Name(&quot;render&quot;)]
    public extern static void Render(ReactElement element, Element container);
  }
}
</code></pre>
<p>Any references in the C# code to this class will try to access it within the &quot;Bridge.React&quot; namespace, so the C# compiler thinks its fully qualified class name is &quot;Bridge.React.React&quot;; in the JavaScript, though, this is <em>not</em> the case, the class is just called &quot;React&quot;. The Bridge.net attribute &quot;Name&quot; allows us to tell the translator this - so when the C# code is translated into JavaScript, any references to &quot;Bridge.React.React&quot; will be rewritten to simply &quot;React&quot;.</p>
<p>The same is applied to the method &quot;Render&quot; - in my C# code, I stick to the convention of pascal-casing function names, but the React library (like much other modern JavaScript) uses camel-cased function names.</p>
<p>Also note that the &quot;Render&quot; method does not have an implementation, it is marked as &quot;extern&quot;. This is more commonly used in C# code to access unmanaged DLL functions but the bindings to JavaScript that we're describing are a similar mechanism - no body for this method needs to be included since the method itself is implemented elsewhere (in the React library, in this case). In order to be marked as &quot;extern&quot;, a function must be decorated with an attribute (otherwise the compiler generates warnings). It doesn't matter <em>what</em> attribute is used, so the presence of the &quot;Name&quot; attribute is good enough.</p>
<p>For the function's arguments, the <strong>Element</strong> type is a Bridge.net class that represents DOM elements while the <strong>ReactElement</strong> is one that we must define as a binding -</p>
<pre><code>namespace Bridge.React
{
  [Ignore]
  public sealed class ReactElement
  {
    private ReactElement() { }
  }
}
</code></pre>
<p>This will never be explicitly instantiated, so it's a sealed class with a private constructor. It also does not need to be directly represented in the generated JavaScript, so it has an &quot;Ignore&quot; attribute on it too.</p>
<p>But, if <strong>ReactElement</strong> is never directly instantiated, how do we get instances of it? Well, there's the builtin React element creator functions (eg. &quot;React.DOM.div&quot;, &quot;React.DOM.span&quot;, etc..) and there are custom components. The builtin functions are nice and simple to writing bindings for, so I'll talk about them later and get to the interesting stuff..</p>
<h3 id="creating-react-components-in-bridge.net"><a href="/react-and-flux-with-bridgenet#creating-react-components-in-bridge.net">Creating React components in Bridge.net</a></h3>
<p>Since React 0.13 was released earlier this year, it has been possible to write JavaScript &quot;classes&quot; that may be used as React components. I write &quot;classes&quot; in quotes because a class is an ES6 concept but the code that transpilers emit (that take ES6 JavaScript and create equivalent code that will work on browsers that don't support ES6) is similar enough to the code generated by Bridge.net (and DuoCode) that we can use classes written in C# and rely upon the emitted JavaScript working nicely with React.. so long as a couple of rules are followed:</p>
<ol>
<li>These component classes will never be directly instantiated in code, so there should be no public constructor defined since it will never be called</li>
<li>The way that they <em>will</em> be initialised is by the React library, via a &quot;React.createElement&quot; call - this will take the type of the component and will create some form of object <em>based upon</em> the component but according to its own rules (these are implementation details of the React library and should just be considered to be magic; trying to take advantage of any particular implementation detail is a good way to write a component that will break in a future version of React)</li>
<li>The &quot;createElement&quot; call will also take a &quot;props&quot; reference, which will be set on the resulting React element - this is how a component is configured, rather than via the constructor (this &quot;props&quot; reference is private to the component and is guaranteed to be set as soon as the instance is created, so it's much more like &quot;constructor dependency injection&quot; than &quot;property setter dependency injection&quot;)</li>
<li>The components require a &quot;render&quot; method that returns a <strong>ReactElement</strong></li>
</ol>
<p>The surgery that React carries out to create components based upon classes is quite invasive, not only in how it new's-up an instance but also in how it investigates the &quot;props&quot; data. For each initialisation, it tears apart the provided props reference and creates a new object of its own devising, copying over the object properties from the original reference onto its own version.</p>
<p>This is problematic if the props reference you give is a class translated from C# since any methods (including property getters / setters) will be ignored by this process (React only copies properties that report true for &quot;hasOwnProperty&quot; and so ignores any class methods since these will be declared on the prototype of the class, not on the instance itself). The way to get around this is to wrap the props data in another object, one that has only a single field &quot;Props&quot;, which is a reference back to the original props data - then, when React copies the properties around, this value will be migrated over without issue. The only annoyance is that this data must be unwrapped again before you can use it.</p>
<p>However, because I'm so good to you, I've pulled most of this together into an abstract class that you may use to derive custom component classes from -</p>
<pre><code>using System;

namespace Bridge.React
{
  public abstract class Component&lt;TProps&gt;
  {
    public static ReactElement New&lt;TComponent&gt;(TProps props)
      where TComponent : Component&lt;TProps&gt;
    {
      if (props == null)
        throw new ArgumentNullException(&quot;props&quot;);

      return Script.Call&lt;ReactElement&gt;(
        &quot;React.createElement&quot;,
        typeof(TComponent),
        new PropsWrapper { Props = props }
      );
    }

    [Name(&quot;render&quot;)]
    public abstract ReactElement Render();

    [Name(&quot;unwrappedProps&quot;)]
    protected TProps props
    {
      get { return wrappedProps.Props; }
    }

    [Name(&quot;props&quot;)]
    private readonly PropsWrapper wrappedProps = null;

    [ObjectLiteral]
    private class PropsWrapper
    {
      public TProps Props;
    }
  }
}
</code></pre>
<p>There is a static &quot;New&quot; method that is used to create a <strong>ReactElement</strong> instance based upon the derived component class' type (using the &quot;React.createElement&quot; function). In the C# code, you call &quot;New&quot; with a &quot;props&quot; reference of the appropriate type and you get a <strong>ReactElement</strong> back. The &quot;appropriate type&quot; is the <strong>TProps</strong> generic type parameter of this base class. Making this a generic class means that calling code knows what data is required to create a new element instance (ie. a <strong>TProps</strong> instance) and the derived component class has a strongly-typed (again, <strong>TProps</strong>) reference to that props data.</p>
<p>There is a &quot;Render&quot; method that must be implemented on the derived class. It has a &quot;Name&quot; attribute to map my C# naming convention (of pascal-cased function names) onto React's convention (of camel-cased function names).</p>
<p>You can also see some messing about with the props data - the call to &quot;React.createElement&quot; uses a <strong>PropsWrapper</strong> which puts the &quot;props&quot; reference into a single property, as I described above. This will not be torn to shreds by React when it creates a new element. This data is then readable via the private &quot;wrappedProps&quot; property - since this is <em>private</em> to this base class, derived classes can not access it. They <em>have</em> to retrieve props data through the &quot;props&quot; property (which has type <strong>TProps</strong>, rather than <strong>PropsWrapper</strong>).</p>
<p>Now, there is some jiggery-pokery here, since the &quot;wrappedProps&quot; property has a &quot;Name&quot; attribute which indicates that this maps to a property called &quot;props&quot; in the JavaScript - but, as just described, this is a wrapper that keeps the real data safe from React's meddling. Similarly, the &quot;props&quot; property (which has &quot;protected&quot; accessibility and so is accessible by the derived type) has a &quot;Name&quot; attribute which maps it onto a property named &quot;unwrappedProps&quot; - this is <em>not</em> something that React has anything to do with, it's only to avoid clashing with the <em>real</em> &quot;props&quot; reference in the output JavaScript, while allowing C# code to be written that accesses a &quot;props&quot; property that is an <em>unwrapped</em> version of the props data.</p>
<p>Wow, that all sounds really confusing! But the upshot is that you can create a component as easily as:</p>
<pre><code>using Bridge.React;

namespace BridgeExamples
{
  public class WelcomeComponent : Component&lt;WelcomeComponent.Props&gt;
  {
    public static ReactElement New(Props props)
    {
      return New&lt;WelcomeComponent&gt;(props);
    }
    private WelcomeComponent() { }

    public override ReactElement Render()
    {
      return DOM.Div(null, &quot;Hi &quot; + props.Name);
    }

    public class Props
    {
      public Props(string name)
      {
        Name = name;
      }
      public string Name { get; private set; }
    }
  }
}
</code></pre>
<p>Note that the &quot;Render&quot; method accesses &quot;props.Name&quot; directly - all of the wrapping / unwrapping is hidden away in the base class, the derived class is happily oblivious to all that <strong>PropsWrapper</strong> madness.</p>
<p>Also note that the constructor has been declared as private, which is important since these components should never be instantiated directly - they should <em>only</em> be brought into existence via that &quot;React.createElement&quot; function. To this end, a static &quot;New&quot; function is present (which calls the static &quot;New&quot; function on the base class).</p>
<p>(One <em>more</em> note - there's an attribute used by the <strong>Component</strong> base class that I haven't explained: &quot;ObjectLiteral&quot;, I'll come back to this later..)</p>
<p>Bringing all this together, we could use this component in code such as:</p>
<pre><code>React.Render(
  WelcomeComponent.New(new WelcomeComponent.Props(name: &quot;Ted&quot;)),
  Document.GetElementById(&quot;main&quot;)
);
</code></pre>
<p>But before doing so, we'd better get back to the builtin React element creation functions..</p>
<p><em>Warning (July 2015): The code above will actually fail at runtime with the current version of Bridge (1.7) because of <a href="http://forums.bridge.net/forum/bridge-net-pro/bugs/314-closed-306-failure-to-identify-generic-static-method-on-derived-class-as-call-targeti">a bug I reported in their forums</a> - however this has been fixed and will be included in the next release. I'm being optimistic and hoping that this article will be relevant in the future when this bug is just a distant memory :) Until the version after 1.7 is released, replace the line</em></p>
<pre><code>return New&lt;WelcomeComponent&gt;(props);
</code></pre>
<p><em>with</em></p>
<pre><code>return Component&lt;WelcomeComponent.Props&gt;.New&lt;WelcomeComponent&gt;(props);
</code></pre>
<p><em>and it will work fine. But in the future the less verbose version shown in the <strong>WelcomeComponent</strong> example will be safe.</em></p>
<h3 id="bindings-for-the-regular-dom-element-functions"><a href="/react-and-flux-with-bridgenet#bindings-for-the-regular-dom-element-functions">Bindings for the regular DOM element functions</a></h3>
<p>I skirted around the DOM functions such as React.DOM.div, React.DOM.span, etc.. earlier, so let's deal with them now.</p>
<p>In order to do so, I need to teach the type system a little trick. A component's &quot;Render&quot; method must always return a genuine <strong>ReactElement</strong>, but when specifying child elements for use in a component we must be able to provide <em>either</em> a <strong>ReactElement</strong> <em>or</em> a simple string. This is what was happening in the line from the <strong>WelcomeComponent</strong>:</p>
<pre><code>return DOM.Div(null, &quot;Hi &quot; + props.Name);
</code></pre>
<p>The null value is for the attributes of the div (and is interpreted as &quot;this div does not need any html attributes&quot;), while the second argument is a string that is the sole child element of that div.</p>
<p>So we need a way to say that the child element argument value(s) for a DOM.div call may be either a <strong>ReactElement</strong> or a string. In some languages (such as TypeScript and F#), we could consider a union type, but here I'll cheat a bit and declare the &quot;React.DOM.Div&quot; function as:</p>
<pre><code>namespace Bridge.React
{
  [Name(&quot;React.DOM&quot;)]
  [Ignore]
  public static class DOM
  {
    [Name(&quot;div&quot;)]
    public extern static ReactElement Div(
      HTMLAttributes properties,
      params ReactElementOrText[] children
    );
</code></pre>
<p>and then define a new <strong>ReactElementOrText</strong> type -</p>
<pre><code>namespace Bridge.React
{
  [Ignore]
  public sealed class ReactElementOrText
  {
    private ReactElementOrText() { }
    [Ignore]
    public extern static implicit operator ReactElementOrText(string text);
    [Ignore]
    public extern static implicit operator ReactElementOrText(ReactElement element);
  }
</code></pre>
<p>This is another class with an &quot;Ignore&quot; attribute since it does not require any JavaScript to be generated for it, it's just to provide information to the C# compiler. It means that anywhere that a <strong>ReactElementOrText</strong> type is specified as an argument type, it is valid to provide either a <strong>ReactElement</strong> or a string. (The &quot;Ignore&quot; attributes on the functions are only present so that they may be identified as &quot;extern&quot; - as described earlier, an &quot;extern&quot; function <em>must</em> be decorated with an attribute of some kind).</p>
<p>The <strong>DOM</strong> class makes further of the &quot;Name&quot; attribute, ensuring that any accesses in C# to &quot;Bridge.React.DOM&quot; are replaced with just &quot;React.DOM&quot; in the generated JavaScript.</p>
<p>The final piece of the puzzle is the <strong>HTMLAttributes</strong> class -</p>
<pre><code>using Bridge;

namespace Bridge.React
{
  [ObjectLiteral]
  public class HTMLAttributes
  {
    public string className;
  }
}
</code></pre>
<p>As you can probably tell, this is <em>not</em> the full-featured React interface (&quot;className&quot; is <em>not</em> the only attribute that you can add to a div!) - at this point in time, it's still early days for the bindings that I'm writing for Bridge.net / React, so I've cut some corners. You'll see further down that I've not done all of the bindings for the DOM elements either! But hopefully this article is enough to get you up and running, then you can add to it yourself as you need more. (I'll also link to a repo at the end of the post..)</p>
<p><strong>HTMLAttributes</strong> is another type that we don't directly want to include in the generated JavaScript. If we have the C# line -</p>
<pre><code>return DOM.Div(new HTMLAttributes { className = &quot;welcome&quot; }, &quot;Hello!&quot;);
</code></pre>
<p>we want this to be translated into the following:</p>
<pre><code>return React.DOM.div({ className = &quot;welcome&quot; }, &quot;Hello!&quot;);
</code></pre>
<p>This is idiomatic React-calling code.</p>
<p>Bridge.net has support to instruct the compiler to interpret class constructors in this way; through use of the &quot;ObjectLiteral&quot; attribute. When a class that is decorated with this attribute has its constructor called in C#, the generated JavaScript will just use the object literal notation rather than actually creating a full class instance. Note that this means that no JavaScript will be generated for that class, so the <strong>HTMLAttributes</strong> class does not appear in the JavaScript at any point.</p>
<p>We saw this &quot;ObjectLiteral&quot; attribute used earlier, on the <strong>Component</strong> base class - it was used for the wrapper around the props data. That wrapper is only used to nest the real &quot;props&quot; reference inside a property so that React's internals don't try to mess with it. It would be unnecessary to wrap that reference up inside a full class instance, it is more sensible for the generated JavaScript to be simply -</p>
<pre><code>return React.createElement(TComponent, { props: props });
</code></pre>
<p>as opposed to something like</p>
<pre><code>return React.createElement(
  TComponent,
  Bridge.merge(
    new Bridge.React.Component.PropsWrapper$1(TProps)(),
    { props: props }
  )
);
</code></pre>
<p>(which is what Bridge would emit if the <strong>PropsWrapper</strong> type did <em>not</em> have the &quot;ObjectLiteral&quot; attribute on it).</p>
<h3 id="more-dom-bindings"><a href="/react-and-flux-with-bridgenet#more-dom-bindings">More DOM bindings..</a></h3>
<p>As with the poorly-populated <strong>HTMLAttributes</strong> class, I also haven't written too many DOM element bindings yet. All I've got so far is &quot;div&quot;, &quot;h1&quot;, &quot;input&quot; and &quot;span&quot; - these have been enough for the sample projects I've started to experiment with integrating Bridge and React. However, the good news is that these few bindings illustrate enough principles that it should be clear how to write more as you need them.</p>
<p>The element creation functions that I have are as such:</p>
<pre><code>using Bridge;

namespace Bridge.React
{
  [Name(&quot;React.DOM&quot;)]
  [Ignore]
  public static class DOM
  {
    [Name(&quot;div&quot;)]
    public extern static ReactElement Div(
      HTMLAttributes properties,
      params ReactElementOrText[] children
    );
    [Name(&quot;h1&quot;)]
    public extern static ReactElement H1(
      HTMLAttributes properties,
      params ReactElementOrText[] children
    );
    [Name(&quot;input&quot;)]
    public extern static ReactElement Input(
      InputAttributes properties,
      params ReactElementOrText[] children
    );
    [Name(&quot;span&quot;)]
    public extern static ReactElement Span(
      HTMLAttributes properties,
      params ReactElementOrText[] children
    );
  }
}
</code></pre>
<p>&quot;Span&quot; and &quot;H1&quot; are just the same as &quot;Div&quot;.</p>
<p>&quot;Input&quot; is interesting, though..</p>
<p>I started by following the same basic pattern for the <strong>InputAttribute</strong> type as you would find in the <a href="https://github.com/borisyankov/DefinitelyTyped/tree/master/react">React bindings for TypeScript</a> - there is an &quot;onChange&quot; callback which provides a <strong>FormEvent</strong> instance, which is a type that is derived from <strong>SyntheticEvent</strong> (names taken directly from the TypeScript binding).</p>
<p>The big difference is that the TypeScript bindings do not expose a &quot;target&quot; property on <strong>FormEvent</strong> to tie the event back to the element that it relates to, even though this information is available on the React event. I've exposed this information as the &quot;target&quot; property on <strong>FormEvent</strong> <em>and</em> exposed it as a known-type using the generic <strong>FormEvent</strong> class - the <strong>InputAttributes</strong> has an &quot;onChange&quot; type of <strong>Action&lt;FormEvent&lt;InputEventTarget&gt;&gt;</strong> which means that the type of &quot;target&quot; on the <strong>FormEvent</strong> will be an <strong>InputEventTarget</strong>. This allows us to query the input's value in the onChange callback, something that is a bit awkward with the TypeScript bindings.</p>
<p>(This is only possible because the React model exposes this information - bindings do not include their own logic, they <em>only</em> describe to the Bridge compiler how to interact with an existing library).</p>
<pre><code>using Bridge;

namespace Bridge.React
{
  [ObjectLiteral]
  public class InputAttributes : HTMLAttributes
  {
    public Action&lt;FormEvent&lt;InputEventTarget&gt;&gt; onChange;
    public string value;
  }

  [Ignore]
  public class FormEvent&lt;T&gt; : FormEvent where T : EventTarget
  {
    public new T target;
  }

  [Ignore]
  public class FormEvent : SyntheticEvent
  {
    public EventTarget target;
  }

  [Ignore]
  public class SyntheticEvent
  {
    public bool bubbles;
    public bool cancelable;
    public bool defaultPrevented;
    public Action preventDefault;
    public Action stopPropagation;
    public string type;
  }

  [Ignore]
  public class InputEventTarget : EventTarget
  {
    public string value;
  }

  [Ignore]
  public class EventTarget { }
}
</code></pre>
<p>There are obviously more properties that belong on the <strong>InputAttribute</strong> type (such as &quot;onKeyDown&quot;, &quot;onKeyPress&quot;, &quot;onKeyUp&quot; and many others) but for now I just wanted to write enough to prove the concept.</p>
<h3 id="flux"><a href="/react-and-flux-with-bridgenet#flux">Flux</a></h3>
<p>There's nothing that requires that you use the Flux architecture when you're using React, but I think it makes a huge amount of sense. When I was getting to grips with the React library, I found myself moving towards a similar solution before I'd read up on Flux - so when I <em>did</em> read about it, it was like someone had taken the vague ideas I'd had, tightened them all up and hammered out the rough edges.</p>
<p>The thing with it is, it really is just a set of architectural guidelines, it's <em>not</em> an actual library like React. It explains that you have &quot;Stores&quot; that manage state for the application - these Stores listen out for events that may require that they change their current state. This state is displayed using React, basically. The events that the Stores listen out for may be the result of a user interacting with the React elements or they may be raised by an API, informing the application that data that the user requested has arrived.</p>
<p>The piece in the middle is the &quot;Dispatcher&quot; and is effectively a queue that events can be pushed on (by user interactions or whatever else) and listened out for by the Stores - any events that a Store is not interested in, it ignores.</p>
<p><em>Asynchronous processes are quite easily handled in this arrangement because you can fire off an event as soon as an async request starts (in case some sort of loading spinner is desired) and then fire off another event when the data arrives (or when it times out or errors in some other way). Whatever happens, it's just events being raised and then received by interested Stores; Stores which alter their state and get React to re-render (if state changes were, in fact, required).</em></p>
<p>Using C# to write such a Dispatcher queue is really easy. Internally, it uses a C# event to make it easy to register (and then to call) as many listeners as required.</p>
<p><em>When compiled for the <a href="https://msdn.microsoft.com/en-us/library/8bs2ecf4(v=vs.110).aspx">CLR</a>, events are translated into IL that does all sorts of clever magic to behave well (and efficiently) in a multi-threaded environment. But here, it will be translated into JavaScript for the browser, which is single-threaded! So everything's very simple in the generated JavaScript</em> and <em>the C#.</em></p>
<pre><code>using System;

namespace Bridge.React
{
  public class AppDispatcher
  {
    private event Action&lt;DispatcherMessage&gt; _dispatcher;

    public void Register(Action&lt;DispatcherMessage&gt; callback)
    {
      _dispatcher += callback;
    }

    public void HandleViewAction(IDispatcherAction action)
    {
      if (action == null)
        throw new ArgumentNullException(&quot;action&quot;);

      _dispatcher(new DispatcherMessage(MessageSourceOptions.View, action));
    }

    public void HandleServerAction(IDispatcherAction action)
    {
      if (action == null)
        throw new ArgumentNullException(&quot;action&quot;);

      _dispatcher(new DispatcherMessage(MessageSourceOptions.Server, action));
    }
  }

  public class DispatcherMessage
  {
    public DispatcherMessage(MessageSourceOptions source, IDispatcherAction action)
    {
      if ((source != MessageSourceOptions.Server) &amp;&amp; (source != MessageSourceOptions.View))
        throw new ArgumentOutOfRangeException(&quot;source&quot;);
      if (action == null)
        throw new ArgumentNullException(&quot;action&quot;);

      Source = source;
      Action = action;
    }

    public MessageSourceOptions Source { get; private set; }
    public IDispatcherAction Action { get; private set; }
  }

  public enum MessageSourceOptions { Server, View }

  public interface IDispatcherAction { }
}
</code></pre>
<p>When you read about Flux events in JavaScript-based tutorials, you will see mention of &quot;Actions&quot; and &quot;Action Creators&quot;. Actions will be JavaScript objects with some particular properties that describe what happened. Action Creators tend to be functions that take some arguments and generate these objects. In C#, I think it makes much more sense for Actions to be classes - that way the Action Creators are effectively just the Actions' constructors!</p>
<p><img src="/Content/Images/Posts/FluxDiagram.png" alt="The Flux Architecture" title="The Flux Architecture" /></p>
<p>The <strong>AppDispatcher</strong> I've included code for above expects actions to be classes that share a common interface: <strong>IDispatcherAction</strong>. This is an &quot;empty interface&quot; and is just used to identify a class as being an action (you might want to search a solution for all Dispatcher actions, for example - you could do this by locating all implementations of <strong>IDispatcherAction</strong>). I wrote about this in terms of TypeScript earlier in the year and much of the same holds true here - so read more at <a href="/typescript-classes-for-react-flux-actions">TypeScript classes for (React) Flux actions</a> if this sounds interesting (or confusing).</p>
<p><em>(Each action is wrapped in a <strong>DispatcherMessage</strong>, which describes it as being either a &quot;Server&quot; or &quot;View&quot; action. A Server action would tend to be a callback from an API event, as opposed to a key press that alters a particular editable field - which would be a View action. Differentiating between the two is a common practice but is optional, so you could drop the <strong>DispatcherMessage</strong> entirely if you wanted to and have the Dispatcher only deal with <strong>IDispatcherAction</strong> implementations. The only really compelling reasons I've encountered for differentiating between the two is that you might want to skip some forms of validation for Server actions since it may be presumed that data from the server is already known to be good).</em></p>
<h3 id="a-complete-example"><a href="/react-and-flux-with-bridgenet#a-complete-example">A complete example</a></h3>
<p>If you want to try any of this out (particularly if you don't feel like trying to piece it all together from the various code samples in this post!) then you can find a complete sample in a Bitbucket repo: <a href="https://bitbucket.org/DanRoberts/reactbridgedotnet/">ReactBridgeDotNet</a>.</p>
<p>It's a web project that follows the structure I outlined at the top of this post - an MVC project to &quot;host&quot; and then Bridge projects to generate JavaScript from C#; one for the React bindings and another for the logic of the app.</p>
<p>The app itself is very, very simple - it's just a text box that doesn't want to be empty. If you clear it then you get a validation message. Any changes that you make to the input box are communicated to the app as Dispatcher actions, each of which results in a full re-render (in a complex app, React's virtual DOM ensures that this is done in an efficient manner, but in such a small example as this it's probably impossible to tell). Meanwhile, a label alongside the input box is updated with the current time - this is done to illustrate how non-user events (such as API data-retrieved events, for example) may be dealt with in exactly the same way as user events; they go through the Dispatcher and a Store deals with applying these channels to its internal state. Have fun!</p>
<p class="PostTime">Posted at 21:17</p><div class="PreviousAndNext"><div class="Previous"><h3>Last time:</h3><a class="Previous" href="/throwing-exceptions-through-com">Throwing exceptions through COM</a></div><div class="Next"><h3>Next:</h3><a class="Next" href="/parsing-typescript-definitions-functionally-ish">Parsing TypeScript definitions (functional-ly.. ish)</a></div></div><div class="Related"><h3>You may also be interested in (see <a href="/automating-suggested-related-posts-links-for-my-blog-posts">here</a> for information about how these are generated):</h3><ul><li><a href="/react-and-flux-with-bridgenet-redux">React (and Flux) with Bridge.net - Redux</a></li><li><a href="/react-and-flux-with-duocode">React and Flux with DuoCode</a></li><li><a href="/typescript-classes-for-react-flux-actions">TypeScript classes for (React) Flux actions</a></li></ul></div><div class="Tags"><label>Tags:</label><ul><li><a href="/Archive/Tag/Bridge" title="12 Posts">Bridge</a></li><li><a href="/Archive/Tag/React" title="11 Posts">React</a></li></ul></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    var disqus_identifier = "87";
                    var disqus_title = "React (and Flux) with Bridge.net";

                    document.addEventListener(
                        "DOMContentLoaded",
                        function () {
                            var singlePostContent = document.querySelector("div.Content.SinglePost");
                            if (!singlePostContent) {
                                return;
                            }
        
                            var getScrolledDownHalfWayEvent = function (callback) {
                                return function () {
                                    var rect = singlePostContent.getBoundingClientRect();
                                    if ((rect.top - window.innerHeight) <= -(rect.height / 2)) {
                                        callback();
                                    }
                                };
                            };
        
                            var scrolledDownHalfWayEvent = getScrolledDownHalfWayEvent(
                                function () {
                                    document.removeEventListener("scroll", scrolledDownHalfWayEvent);
                                    window.removeEventListener("resize", scrolledDownHalfWayEvent);

                                    var dsq = document.createElement("script");
                                    dsq.type = "text/javascript";
                                    dsq.async = true;
                                    dsq.src = "https://" + disqus_shortname + ".disqus.com/embed.js";
                                    (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                                }
                            );
        
                            document.addEventListener("scroll", scrolledDownHalfWayEvent);
                            window.addEventListener("resize", scrolledDownHalfWayEvent);
                        }
                    );
                </script>
    </div>


				<div class="Footer">
					© Productive Rage 2011 - 2022
				</div>
			</div>

			<div class="SideBar">
				<div class="About">
					<h2>About</h2>
					<p>Dan is a big geek who likes making stuff with computers! He can be quite outspoken so clearly needs a blog :)</p>
					<p>In the last few minutes he seems to have taken to referring to himself in the third person. He's quite enjoying it.</p>
					<p><a href="mailto:dangger36@gmail.com" class="Email">dangger36@gmail.com</a></p>
				</div>
				<div class="Search">
<form action="/Search" autocomplete="off" class="Search" method="get">						<div>
							<label class="SearchField">
								<span class="text">Site Search</span>
								<input type="text" class="SiteSearch" name="term" value="" />
							</label>
							<input type="submit" class="SiteSearchSubmit" value="Search" />
						</div>
</form>				</div>
				<div class="Recent"><h2>Recent Posts</h2><ul><li><a href="/approximately-correcting-perspective-with-c-sharp-fixing-a-blurry-presentation-video-part-two">(Approximately) correcting perspective with C# (fixing a blurry presentation video - part two)</a></li><li><a href="/finding-the-brightest-area-in-an-image-with-c-sharp-fixing-a-blurry-presentation-video-part-one">Finding the brightest area in an image with C# (fixing a blurry presentation video - part one)</a></li><li><a href="/so-what-is-machine-learning-nocodeintro">So.. what is machine learning? (#NoCodeIntro)</a></li><li><a href="/parallelising-linq-work-in-c-sharp">Parallelising (LINQ) work in C#</a></li><li><a href="/automating-suggested-related-posts-links-for-my-blog-posts-part-2">Automating &quot;suggested / related posts&quot; links for my blog posts - Part 2</a></li></ul><div class="RSSFeedLink"><a href="https://www.productiverage.com/feed">RSS Feed</a></div></div>
				<div class="Featured"><h2>Highlights</h2><ul><li><a href="/face-or-no-face-finding-faces-in-photos-using-c-sharp-and-accordnet">Face or no face (finding faces in photos using C# and Accord.NET)</a></li><li><a href="/when-a-disk-cache-performs-better-than-an-inmemory-cache-befriending-the-net-gc">When a disk cache performs better than an in-memory cache (befriending the .NET GC)</a></li><li><a href="/performance-tuning-a-bridgenet-react-app">Performance tuning a Bridge.NET / React app</a></li><li><a href="/creating-a-c-sharp-roslyn-analyser-for-beginners-by-a-beginner">Creating a C# (&quot;Roslyn&quot;) Analyser - For beginners by a beginner</a></li><li><a href="/translating-vbscript-into-c-sharp">Translating VBScript into C#</a></li><li><a href="/entity-framework-projections-to-immutable-types-ienumerable-vs-iqueryable">Entity Framework projections to Immutable Types (IEnumerable vs IQueryable)</a></li></ul></div>
				<div class="History"><h2>Archives</h2><ul><li><a href="/Archive/3/2022">March 2022 (2)</a></li><li><a href="/Archive/2/2022">February 2022 (1)</a></li><li><a href="/Archive/8/2021">August 2021 (1)</a></li><li><a href="/Archive/4/2021">April 2021 (2)</a></li><li><a href="/Archive/3/2021">March 2021 (1)</a></li><li><a href="/Archive/8/2020">August 2020 (3)</a></li><li><a href="/Archive/7/2019">July 2019 (2)</a></li><li><a href="/Archive/9/2018">September 2018 (1)</a></li><li><a href="/Archive/4/2018">April 2018 (1)</a></li><li><a href="/Archive/3/2018">March 2018 (1)</a></li><li><a href="/Archive/7/2017">July 2017 (1)</a></li><li><a href="/Archive/6/2017">June 2017 (1)</a></li><li><a href="/Archive/2/2017">February 2017 (1)</a></li><li><a href="/Archive/11/2016">November 2016 (1)</a></li><li><a href="/Archive/9/2016">September 2016 (2)</a></li><li><a href="/Archive/8/2016">August 2016 (1)</a></li><li><a href="/Archive/7/2016">July 2016 (1)</a></li><li><a href="/Archive/6/2016">June 2016 (1)</a></li><li><a href="/Archive/5/2016">May 2016 (3)</a></li><li><a href="/Archive/3/2016">March 2016 (3)</a></li><li><a href="/Archive/2/2016">February 2016 (2)</a></li><li><a href="/Archive/12/2015">December 2015 (1)</a></li><li><a href="/Archive/11/2015">November 2015 (2)</a></li><li><a href="/Archive/8/2015">August 2015 (3)</a></li><li><a href="/Archive/7/2015">July 2015 (1)</a></li><li><a href="/Archive/6/2015">June 2015 (1)</a></li><li><a href="/Archive/5/2015">May 2015 (2)</a></li><li><a href="/Archive/4/2015">April 2015 (1)</a></li><li><a href="/Archive/3/2015">March 2015 (1)</a></li><li><a href="/Archive/1/2015">January 2015 (2)</a></li><li><a href="/Archive/12/2014">December 2014 (1)</a></li><li><a href="/Archive/11/2014">November 2014 (1)</a></li><li><a href="/Archive/10/2014">October 2014 (2)</a></li><li><a href="/Archive/9/2014">September 2014 (2)</a></li><li><a href="/Archive/8/2014">August 2014 (1)</a></li><li><a href="/Archive/7/2014">July 2014 (1)</a></li><li><a href="/Archive/6/2014">June 2014 (1)</a></li><li><a href="/Archive/5/2014">May 2014 (2)</a></li><li><a href="/Archive/2/2014">February 2014 (1)</a></li><li><a href="/Archive/1/2014">January 2014 (1)</a></li><li><a href="/Archive/12/2013">December 2013 (1)</a></li><li><a href="/Archive/11/2013">November 2013 (1)</a></li><li><a href="/Archive/10/2013">October 2013 (1)</a></li><li><a href="/Archive/8/2013">August 2013 (3)</a></li><li><a href="/Archive/7/2013">July 2013 (3)</a></li><li><a href="/Archive/6/2013">June 2013 (1)</a></li><li><a href="/Archive/5/2013">May 2013 (2)</a></li><li><a href="/Archive/4/2013">April 2013 (1)</a></li><li><a href="/Archive/3/2013">March 2013 (8)</a></li><li><a href="/Archive/2/2013">February 2013 (2)</a></li><li><a href="/Archive/1/2013">January 2013 (2)</a></li><li><a href="/Archive/12/2012">December 2012 (3)</a></li><li><a href="/Archive/11/2012">November 2012 (4)</a></li><li><a href="/Archive/9/2012">September 2012 (1)</a></li><li><a href="/Archive/8/2012">August 2012 (1)</a></li><li><a href="/Archive/7/2012">July 2012 (3)</a></li><li><a href="/Archive/6/2012">June 2012 (3)</a></li><li><a href="/Archive/5/2012">May 2012 (2)</a></li><li><a href="/Archive/2/2012">February 2012 (3)</a></li><li><a href="/Archive/1/2012">January 2012 (4)</a></li><li><a href="/Archive/12/2011">December 2011 (7)</a></li><li><a href="/Archive/8/2011">August 2011 (2)</a></li><li><a href="/Archive/7/2011">July 2011 (1)</a></li><li><a href="/Archive/5/2011">May 2011 (1)</a></li><li><a href="/Archive/4/2011">April 2011 (2)</a></li><li><a href="/Archive/3/2011">March 2011 (3)</a></li></ul><div class="EveryTitle"><a href="/Archive/All">Every Post Title</a></div></div>
			</div>

		</div>
	</div>

	<script type="text/javascript" src="/Scripts/autocomplete.js"></script>
	<script type="text/javascript" src="/Scripts/prettify.js"></script>
	<script type="text/javascript" src="/Scripts/Site.js"></script>
	<script type="text/javascript" src="/Scripts/IndexSearchGenerator.js"></script>
	<script type="text/javascript" src="/Scripts/SearchTermHighlighter.js"></script>
	<script type="text/javascript" src="/Scripts/SearchPage.js"></script>
	<script type="text/javascript" src="/Scripts/LZString.js"></script>

</body>
</html>
